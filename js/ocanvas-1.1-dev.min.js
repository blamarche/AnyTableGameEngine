/*!
 * oCanvas v1.1-dev
 * http://ocanvas.org/
 *
 * Copyright 2011, Johannes Koggdal
 * Licensed under the MIT license
 * http://ocanvas.org/license
 *
 * Including Xccessors by Eli Grey
 */
(function(a,b,c){var d={domReady:function(a){/in/.test(b.readyState)?setTimeout("oCanvas.domReady("+a+")",10):a()},canvasList:[],modules:{},inits:{},plugins:{},core:function(a){this.id=d.canvasList.push(this)-1,this.lastObjectID=0;for(var c in d.modules)typeof d.modules[c]=="function"?this[c]=Object.create(d.modules[c]()):this[c]=Object.create(d.modules[c]);this.settings={fps:30,background:"transparent",clearEachFrame:!0,drawEachFrame:!0,disableScrolling:!1,plugins:[]},d.extend(this.settings,a);if(this.settings.canvas.nodeName&&this.settings.canvas.nodeName.toLowerCase()==="canvas")this.canvasElement=this.settings.canvas;else if(typeof this.settings.canvas=="string")this.canvasElement=b.querySelector(this.settings.canvas);else return!1;this.canvas=this.canvasElement.getContext("2d");var e=this.canvasElement.width,f=this.canvasElement.height;Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,set:function(a){e=isNaN(parseFloat(a))?e:parseFloat(a),this.canvasElement.width=e,this.background.set(this.settings.background),this.redraw()},get:function(){return e}}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,set:function(a){f=isNaN(parseFloat(a))?f:parseFloat(a),this.canvasElement.height=f,this.background.set(this.settings.background),this.redraw()},get:function(){return f}});for(var c in d.modules){if(this[c].wrapper===!0)for(var g in this[c])typeof this[c][g]=="object"&&typeof this[c][g].setCore=="function"?this[c][g]=this[c][g].setCore(this):typeof this[c][g].setCore=="function"&&this[c][g].setCore(this),this[c].core=this;this[c].core=this}for(var h in d.inits)if(typeof d.inits[h]=="string"&&typeof this[h][d.inits[h]]=="function")this[h][d.inits[h]]();else if(d.inits[h]==="object")for(var i in d.inits[h])typeof this[h][d.inits[h][i]]=="function"&&this[h][d.inits[h][i]]();var j=this.settings.plugins;if(j.length>0)for(var k=0,l=j.length;k<l;k++)typeof d.plugins[j[k]]=="function"&&d.plugins[j[k]].call(this)},registerModule:function(a,b,e){if(~a.indexOf(".")){var f=a.split(".");d.modules[f[0]][f[1]]=b,e!==c&&(d.inits[f[0]]||(d.inits[f[0]]={}),d.inits[f[0]][f[1]]=e)}else d.modules[a]=b,e!==c&&(d.inits[a]=e)},registerPlugin:function(a,b){d.plugins[a]=b},create:function(a){return new d.core(a)}};d.core.prototype={addChild:function(a,b){a.add(b);return this},removeChild:function(a){a.remove();return this},clear:function(a){this.draw.clear(a);return this},redraw:function(){this.draw.redraw();return this},bind:function(a,b){this.events.bind(this.canvasElement,a,b);return this},unbind:function(a,b){this.events.unbind(this.canvasElement,a,b);return this},trigger:function(a){this.events.trigger(this.canvasElement,a);return this}},a.oCanvas=d,typeof Object.create!="function"&&(Object.create=function(a){function b(){}b.prototype=a;return new b}),a.log=function(){log.history=log.history||[],log.history.push(arguments);if(this.console){var a,b=Array.prototype.slice.call(arguments),c=b.length;for(a=0;a<c;a++)console.log(b[a])}},d.extend=function(){var a=Array.prototype.slice.call(arguments),b=a[a.length-1],c=a.splice(0,1)[0],e=a.splice(0,1)[0],f,g=[],h;b.exclude&&JSON.stringify(b)===JSON.stringify({exclude:b.exclude})&&(g=b.exclude);if(e!==b||g.length===0)for(f in e){if(~g.indexOf(f))continue;h=Object.getOwnPropertyDescriptor(e,f),h.get||h.set?Object.defineProperty(c,f,h):c[f]=e[f]}return a.length>0?d.extend.apply(this,[c].concat(a)):c};var e=function(){return{init:function(){var a=this;this.core.setLoop=function(b){a.userLoop=b;return a}},currentFrame:1,timeline:0,running:!1,set fps(a){this.core.settings.fps=a,this.running&&this.start()},get fps(){return this.core.settings.fps},loop:function(){typeof this.userLoop=="function"&&(this.core.settings.clearEachFrame===!0&&this.core.draw.clear(),this.userLoop.call(this.core,this.core.canvas),this.core.settings.drawEachFrame===!0&&this.core.draw.redraw(),this.currentFrame++)},start:function(){var a=this;clearInterval(a.timeline),a.timeline=setInterval(function(){a.loop()},1e3/a.fps),a.running=!0;return this},stop:function(){clearInterval(this.timeline),this.running=!1;return this}}};d.registerModule("timeline",e,"init");var f=function(){return{eventList:{keydown:{last:-1,length:0},keyup:{last:-1,length:0},keypress:{last:-1,length:0}},keysDown:{},keyPressTimers:{},modifiedKeys:[],lastActiveKeyDown:!1,last_event:{},init:function(){var a=this;this.running=!1,this.core.events.types.keyboard=["keydown","keyup","keypress"],b.addEventListener("keydown",function(b){a.keydown.call(a,b)},!1),b.addEventListener("keyup",function(b){a.keyup.call(a,b)},!1),b.addEventListener("keypress",function(b){a.preventDefault.call(a,b)},!1)},addEvent:function(a,b){this.eventList[a].last++,this.eventList[a].length++;var c=this.eventList[a].last;this.eventList[a][c]=b;return c},removeEvent:function(a,b){delete this.eventList[a][b],this.eventList[a].length--},getKeyCode:function(a){return a.keyCode===0?a.which:a.keyCode},numKeysDown:function(){var a=0,b=this.keysDown;for(var c in b)b[c]===!0&&a++;return a},anyKeysDown:function(){return this.numKeysDown()>0?!0:!1},getKeysDown:function(){var a=this.keysDown,b=[],c;for(c in a)a[c]===!0&&b.push(parseInt(c));return b},triggerEvents:function(a,b){var c,d,e,f;if(!!this.core.events.enabled&&this.core.mouse&&this.core.mouse.canvasFocused===!0){c=this.eventList[a],f=this.core.events.modifyEventObject(b,a);for(d in c)e=c[d],typeof e=="function"&&e(f)}},keydown:function(a){this.last_event=a;var b=this,c=this.getKeyCode(a);this.keysDown[this.getKeyCode(a)]!==!0&&(this.preventDefault(a),this.lastActiveKeyDown=this.getKeyCode(a),this.keysDown[this.lastActiveKeyDown]=!0,this.triggerEvents("keydown",a),this.eventList.keypress.length>0&&(this.keyPressTimers[c]=setInterval(function(){b.keypress(a)},1e3/this.core.settings.fps)))},keyup:function(a){this.last_event=a,this.preventDefault(a);var b=this.getKeyCode(a);b===this.lastActiveKeyDown&&(this.lastActiveKeyDown=!1),delete this.keysDown[b],this.triggerEvents("keyup",a);if(!this.anyKeysDown())for(var b in this.keyPressTimers)clearInterval(this.keyPressTimers[b]);else clearInterval(this.keyPressTimers[b])},keypress:function(a){this.last_event=a,this.triggerEvents("keypress",a)},addPreventDefaultFor:function(a){a=typeof a=="number"?[a]:a.constructor===Array?a:[];for(var b=0;b<a.length;b++)this.modifiedKeys.push(a[b])},removePreventDefaultFor:function(a){a=typeof a=="number"?[a]:a.constructor===Array?a:[];var b,c;for(b=0;b<a.length;b++)c=this.modifiedKeys.indexOf(a[b]),~c&&this.modifiedKeys.splice(c,1)},preventDefault:function(a){if(this.core.mouse&&this.core.mouse.canvasFocused===!0){var b=this.getKeyCode(a);~this.modifiedKeys.indexOf(b)&&a.preventDefault()}},ARROW_UP:38,ARROW_DOWN:40,ARROW_LEFT:37,ARROW_RIGHT:39,SPACE:32,ENTER:13,ESC:27}};d.registerModule("keyboard",f,"init");var g=function(){return{eventList:{mousemove:{last:-1,length:0},mouseenter:{last:-1,length:0},mouseleave:{last:-1,length:0},click:{last:-1,length:0},mousedown:{last:-1,length:0},mouseup:{last:-1,length:0}},last_event:{},cursorValue:"default",init:function(){var c=this,d=this.core,e=d.canvasElement,f;d.events.types.mouse=f=["mousemove","mouseenter","mouseleave","mousedown","mouseup","click"],d.events.pointers.mouse=function(c,d){~f.indexOf(c)&&!("ontouchstart"in a||"createTouch"in b)&&d("mouse","click")},d.pointer=this,this.x=0,this.y=0,this.buttonState="up",this.canvasFocused=!1,this.canvasHovered=!1,this.cancel(),e.addEventListener("mousemove",function(a){c.mousemove.call(c,a)},!1),e.addEventListener("mousedown",function(a){c.mousedown.call(c,a)},!1),e.addEventListener("mouseup",function(a){c.mouseup.call(c,a)},!1),b.addEventListener("mouseup",function(a){c.docmouseup.call(c,a)},!1),b.addEventListener("mouseover",function(a){c.docmouseover.call(c,a)},!1),b.addEventListener("mousedown",function(a){c.docmousedown.call(c,a)},!1),parent!==a&&parent.document.addEventListener("mouseover",function(a){c.docmouseover.call(c,a)},!1)},addEvent:function(a,b){this.eventList[a].last++,this.eventList[a].length++;var c=this.eventList[a].last;this.eventList[a][c]=b;return c},removeEvent:function(a,b){delete this.eventList[a][b],this.eventList[a].length--},getPos:function(d){var e,f,g=this.core.canvasElement.getBoundingClientRect(),h=b.documentElement||b.body.parentNode,i=h&&typeof h.ScrollTop=="number"?h:b.body,j=a.scrollX!==c?a.scrollX:a.pageXOffset!==c?a.pageXOffset:i.ScrollLeft,k=a.scrollY!==c?a.scrollY:a.pageYOffset!==c?a.pageYOffset:i.ScrollTop;d.pageX!==c&&d.pageY!==c?(e=d.pageX-j-Math.round(g.left),f=d.pageY-k-Math.round(g.top)):d.clientX!==c&&d.clientY!==c&&(e=d.clientX+j-Math.round(g.left),f=d.clientY+k-Math.round(g.top));return{x:e,y:f}},updatePos:function(a){var b=this.getPos(a);this.x=b.x,this.y=b.y;return b},onCanvas:function(a){a=a||this.last_event;var b=a?this.getPos(a):{x:this.x,y:this.y};if(b.x>=0&&b.x<=this.core.width&&b.y>=0&&b.y<=this.core.height){this.canvasHovered=!0,this.updatePos(a);return!0}this.canvasHovered=!1;return!1},triggerEvents:function(a,b,c){c=c||!1;if(!!this.core.events.enabled){var d=this.core.events.modifyEventObject(b,a);d.x=this.x,d.y=this.y,d.button===0&&~"mousedown mouseup click".indexOf(a)?d.which=1:d.button===2?d.which=2:d.button===1?d.which=3:d.which=0,this.core.events.triggerPointerHandlers(this.eventList[a],d,c)}},mousemove:function(a){this.last_event=a,this.updatePos(a),this.canvasHovered=!0,this.triggerEvents("mouseenter",a),this.triggerEvents("mousemove",a),this.triggerEvents("mouseleave",a)},mousedown:function(a){this.canvasFocused=!0,this.last_event=a,this.start_pos=this.getPos(a),this.buttonState="down",this.triggerEvents("mousedown",a);return!1},mouseup:function(a){this.last_event=a,this.buttonState="up",this.triggerEvents("mouseup",a),this.triggerEvents("click",a),this.cancel()},docmouseup:function(a){this.last_event=a,this.buttonState==="down"&&!this.onCanvas(a)&&this.mouseup(a)},docmouseover:function(a){this.last_event=a,this.onCanvas(a)||this.triggerEvents("mouseleave",a,!0)},docmousedown:function(a){this.last_event=a,this.onCanvas(a)||(this.canvasFocused=!1)},cancel:function(){this.start_pos={x:-10,y:-10};return this},hide:function(){this.core.canvasElement.style.cursor="none";return this},show:function(){this.core.canvasElement.style.cursor=this.cursorValue;return this},cursor:function(a){if(~a.indexOf("url(")){var b=/url\((.*?)\)(\s(.*?)\s(.*?)|)($|,.*?$)/.exec(a),c=b[5]?b[5]:"";a="url("+b[1]+") "+(b[3]?b[3]:0)+" "+(b[4]?b[4]:0)+(c!==""?c:", default")}this.core.canvasElement.style.cursor=a,this.cursorValue=a;return this}}};d.registerModule("mouse",g,"init");var h=function(){return{eventList:{touchstart:{last:-1,length:0},touchend:{last:-1,length:0},touchmove:{last:-1,length:0},touchenter:{last:-1,length:0},touchleave:{last:-1,length:0},tap:{last:-1,length:0}},last_event:{},init:function(){var c=this,d=this.core,e=d.canvasElement,f,g="ontouchstart"in a||"createTouch"in b;d.events.types.touch=f=["touchstart","touchend","touchmove","touchenter","touchleave","tap"],d.events.pointers.touch=function(a,b){~f.indexOf(a)&&g&&b("touch","tap")},g&&(d.pointer=this,e.style.WebkitUserSelect="none",e.style.WebkitTouchCallout="none",e.style.WebkitTapHighlightColor="rgba(0,0,0,0)"),this.x=-1,this.y=-1,this.touchState="up",this.canvasFocused=!1,this.canvasHovered=!1,this.cancel(),e.addEventListener("touchmove",function(a){c.touchmove.call(c,a)},!1),e.addEventListener("touchstart",function(a){c.touchstart.call(c,a)},!1),e.addEventListener("touchend",function(a){c.touchend.call(c,a)},!1),d.settings.disableScrolling&&e.addEventListener("touchmove",function(a){c.doctouchmove.call(c,a),a.preventDefault()},!1),b.addEventListener("touchend",function(a){c.doctouchend.call(c,a)},!1),b.addEventListener("touchmove",function(a){c.doctouchmove.call(c,a)},!0),b.addEventListener("touchstart",function(a){c.doctouch.call(c,a)},!0)},addEvent:function(a,b){this.eventList[a].last++,this.eventList[a].length++;var c=this.eventList[a].last;this.eventList[a][c]=b;return c},removeEvent:function(a,b){delete this.eventList[a][b],this.eventList[a].length--},getPos:function(a){var b,d;if(a.touches!==c){var e=this.core.canvasElement.getBoundingClientRect(),f=a.touches.length;a.touches.length>0&&(a=a.touches[0],a.pageX&&a.pageY?(b=a.pageX-(Math.round(e.left)<0?0:Math.round(e.left)),d=a.pageY-(Math.round(e.top)<0?0:Math.round(e.top))):(b=this.x,d=this.y))}else b=this.x,d=this.y;return{x:b,y:d}},updatePos:function(a){var b=this.getPos(a);this.x=b.x,this.y=b.y;return b},onCanvas:function(a){a=a||this.last_event;var b=a?this.getPos(a):{x:this.x,y:this.y};if(b.x>=0&&b.x<=this.core.width&&b.y>=0&&b.y<=this.core.height){this.canvasHovered=!0,this.updatePos(a);return!0}this.canvasHovered=!1;return!1},triggerEvents:function(a,b,c){c=c||!1;if(!!this.core.events.enabled){var d=this.core.events.modifyEventObject(b,a);d.x=this.x,d.y=this.y,d.which=0,this.core.events.triggerPointerHandlers(this.eventList[a],d,c)}},touchmove:function(a){this.last_event=a,this.onCanvas(a)&&(this.canvasHovered=!0,this.triggerEvents("touchenter",a),this.triggerEvents("touchmove",a),this.triggerEvents("touchleave",a))},touchstart:function(a){this.canvasFocused=!0,this.last_event=a,this.onCanvas(a)&&(this.start_pos=this.updatePos(a),this.touchState="down",this.triggerEvents("touchenter",a),this.triggerEvents("touchstart",a));return!1},touchend:function(a){this.last_event=a,this.touchState="up",this.triggerEvents("touchleave",a,!0),this.triggerEvents("touchend",a),this.triggerEvents("tap",a),this.cancel()},doctouchend:function(a){this.touchState==="down"&&!this.onCanvas(a)&&this.touchend(a)},doctouchmove:function(a){this.canvasHovered&&!this.onCanvas(a)&&this.triggerEvents("touchleave",a,!0)},doctouch:function(a){this.onCanvas(a)||(this.canvasFocused=!1)},cancel:function(){this.start_pos={x:-10,y:-10};return this}}};d.registerModule("touch",h,"init");var i=function(){return{transformPointerPosition:function(a,b,c,d,e){d=d||0,e=e||this.core.pointer;if(typeof a=="object"){var f=a.parent,g=[],h,i,j={x:0,y:0},k;g.push(a);while(f)g.push(f),f=f.parent;g.reverse(),h=e;for(n=0,l=g.length;n<l;n++)i=g[n],j=this.transformPointerPosition(i.rotation,i.abs_x,i.abs_y,0,h),h=j;d!==0&&(k=a.getOrigin(),j=this.transformPointerPosition(d*-1,b,c,0,h));return{x:j.x,y:j.y}}var m=a,o=e.x>=b&&e.y<=c,p=e.x>=b&&e.y>=c,q=e.x<=b&&e.y>=c,r=e.x<=b&&e.y<=c,s=Math.sqrt(Math.pow(e.x-b,2)+Math.pow(e.y-c,2)),m=(m/360-Math.floor(m/360))*360-d,t,u,v,w=s===0?0:Math.abs(e.y-c)/s;if(o||q)t=(180-m-Math.asin(w)*180/Math.PI)*Math.PI/180,u=b+Math.cos(t)*s*(o?-1:1),v=c+Math.sin(t)*s*(o?-1:1);else if(r||p)t=(Math.asin(w)*180/Math.PI-m)*Math.PI/180,u=b+Math.cos(t)*s*(r?-1:1),v=c+Math.sin(t)*s*(r?-1:1);return{x:u,y:v}},isPointerInside:function(a,b){var c=a.getOrigin();if(a.type==="line"){var d=Math.abs(a.end.x-a.abs_x),e=Math.abs(a.end.y-a.abs_y),f=Math.sqrt(d*d+e*e),g=Math.asin(e/f)*180/Math.PI,h=this.transformPointerPosition(a,a.abs_x,a.abs_y,g*-1,b);return h.x>a.abs_x-f-c.x&&h.x<a.abs_x+f-c.x&&h.y>a.abs_y-a.strokeWidth/2-c.y&&h.y<a.abs_y+a.strokeWidth/2-c.y}if(a.type==="text"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),i=a.strokeWidth/2,j,k,l,m;a.align==="left"?(j=a.abs_x,k=a.abs_x+a.width):a.align==="center"?(j=a.abs_x-a.width/2,k=a.abs_x+a.width/2):a.align==="right"?(j=a.abs_x-a.width,k=a.abs_x):a.align==="start"?this.core.canvasElement.dir==="rtl"?(j=a.abs_x-a.width,k=a.abs_x):(j=a.abs_x,k=a.abs_x+a.width):a.align==="end"&&(this.core.canvasElement.dir==="rtl"?(j=a.abs_x,k=a.abs_x+a.width):(j=a.abs_x-a.width,k=a.abs_x)),a.baseline==="top"?l=a.abs_y+a.height*.05:a.baseline==="hanging"?l=a.abs_y-a.height*.12:a.baseline==="middle"?l=a.abs_y-a.height*.47:a.baseline==="alphabetic"?l=a.abs_y-a.height*.78:a.baseline==="ideographic"?l=a.abs_y-a.height*.83:a.baseline==="bottom"&&(l=a.abs_y-a.height),m=l+a.height;return h.x>j-c.x-i&&h.x<k-c.x+i&&h.y>l-c.y-i&&h.y<m-c.y+i}if(a.shapeType==="rectangular"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),i=a.strokePosition==="outside"?a.strokeWidth:a.strokePosition==="center"?a.strokeWidth/2:0;return h.x>a.abs_x-c.x-i&&h.x<a.abs_x+a.width-c.x+i&&h.y>a.abs_y-c.y-i&&h.y<a.abs_y+a.height-c.y+i}if(a.type==="ellipse"&&a.radius_x===a.radius_y){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),f=Math.sqrt(Math.pow(h.x-a.abs_x+c.x,2)+Math.pow(h.y-a.abs_y+c.y,2));return f<a.radius_x+a.strokeWidth/2}if(a.type==="ellipse"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),n=a.radius_x+a.strokeWidth/2,o=a.radius_y+a.strokeWidth/2;h.x-=a.abs_x+c.x,h.y-=a.abs_y+c.y;return h.x*h.x/(n*n)+h.y*h.y/(o*o)<1}if(a.type==="polygon"){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),p=a.radius+a.strokeWidth/2,q=a.sides,r=q-1,s=!1,t,u,v;for(t=0;t<q;t++)u={x:a.abs_x-c.x+p*Math.cos(t*2*Math.PI/q),y:a.abs_y-c.y+p*Math.sin(t*2*Math.PI/q)},v={x:a.abs_x-c.x+p*Math.cos(r*2*Math.PI/q),y:a.abs_y-c.y+p*Math.sin(r*2*Math.PI/q)},(u.y<h.y&&v.y>=h.y||v.y<h.y&&u.y>=h.y)&&u.x+(h.y-u.y)/(v.y-u.y)*(v.x-u.x)<h.x&&(s=!s),r=t;return s}if(a.type==="arc"){var w=a.direction==="clockwise"?a.end-a.start:Math.abs(a.end-a.start),x=a.direction==="clockwise"?a.start*-1:a.end*-1,h=this.transformPointerPosition(a,a.abs_x-c.x,a.abs_y-c.y,x,b),f=Math.sqrt(Math.pow(h.x-a.abs_x+c.x,2)+Math.pow(h.y-a.abs_y+c.y,2)),p=a.radius,y={},z={},n,A,B,g;if(a.strokeWidth===0&&f>p||a.strokeWidth>0&&f>p+a.strokeWidth/2)return!1;if(p===a.strokeWidth/2){if(w>180){var C,D,E,F;C=Math.abs(a.abs_x-c.x-h.x),D=Math.abs(a.abs_y-c.y-h.y),E=Math.sqrt(C*C+D*D),F=Math.acos(C/E)*180/Math.PI;return h.y>=a.abs_y-c.y&&f<=a.strokeWidth?!0:h.y<a.abs_y-c.y&&h.x<a.abs_x-c.x&&F<=w-180?!0:!1}if(w===180)return h.y>=a.abs_y-c.y&&f<=a.strokeWidth?!0:!1;if(w<180){x=90-w/2-(a.direction==="clockwise"?a.start:a.end),h=this.transformPointerPosition(a,a.abs_x-c.x,a.abs_y-c.y,x,b);var G,C,D,E,F;p*=2,G=Math.cos(w/2*Math.PI/180)*p,C=Math.abs(a.abs_x-c.x-h.x),D=Math.abs(a.abs_y-c.y-h.y),E=Math.sqrt(C*C+D*D),F=Math.asin(C/E)*180/Math.PI;return h.y>=a.abs_y-c.y+G?!0:h.y>=a.abs_y-c.y&&F<=w/2?!0:!1}}else{if(w>180){n=(360-w)/2,A=Math.cos(n*Math.PI/180)*p,y.x=a.abs_x-c.x+Math.cos(n*Math.PI/180)*A,y.y=a.abs_y-c.y-Math.sin(n*Math.PI/180)*A,B=180-2*n,z.x=a.abs_x-c.x-Math.cos(B*Math.PI/180)*p,z.y=a.abs_y-c.y-Math.sin(B*Math.PI/180)*p;var H=90-(90-B)-(90-n);if(h.y<y.y&&h.x<y.x)g=n-Math.acos(Math.abs(h.y-y.y)/Math.sqrt(Math.pow(h.x-y.x,2)+Math.pow(h.y-y.y,2)))*180/Math.PI;else if(h.y>y.y&&h.x>=y.x)g=H-Math.acos(Math.abs(h.x-y.x)/Math.sqrt(Math.pow(h.x-y.x,2)+Math.pow(h.y-y.y,2)))*180/Math.PI;else{if(h.y<a.abs_y-c.y&&h.x>=y.x)return!1;g=-1e6}return g<=0&&h.x>=z.x&&h.y>y.y&&h.y<a.abs_y-c.y?!0:g<=0&&h.y<=a.abs_y-c.y&&f<=p?!0:(a.strokeWidth===0&&f<=p||a.strokeWidth>0&&f<=p+a.strokeWidth/2)&&(h.x<=z.x&&h.y<=a.abs_y-c.y||h.y>=a.abs_y-c.y)?!0:!1}if(w===180)return h.y>=a.abs_y-c.y&&(a.strokeWidth===0&&f<=p||a.strokeWidth>0&&f<=p+a.strokeWidth/2)?!0:!1;if(w<180){x=90-w/2-(a.direction==="clockwise"?a.start:a.end),h=this.transformPointerPosition(a,a.abs_x-c.x,a.abs_y-c.y,x,b);var I,G;I=a.fill===""?p-a.strokeWidth/2:p,G=Math.cos(w/2*Math.PI/180)*I;return a.fill===""&&a.strokeWidth>0?h.y>=a.abs_y-c.y+G&&f>=p-a.strokeWidth/2&&f<=p+a.strokeWidth/2?!0:!1:h.y>=a.abs_y-c.y+G?a.strokeWidth>0?f<=p+a.strokeWidth/2?!0:!1:!0:!1}}}else if(a.shapeType==="radial"){var p=a.radius?a.radius:0;if(p>0){var h=this.transformPointerPosition(a,a.abs_x,a.abs_y,0,b),c=a.getOrigin(),f=Math.sqrt(Math.pow(h.x-a.abs_x+c.x,2)+Math.pow(h.y-a.abs_y+c.y,2));return f<p}}}}};d.registerModule("tools",i);var j=function(){return{types:{},pointers:{},enabled:!0,init:function(){this.core.canvasElement.events={},this.core.canvasElement.drawn=!0,this.core.canvasElement.isPointerInside=function(){return!0}},bind:function(a,b,d){var e=this.core,f,g,h,b=b.split(" "),i,j,k;for(i=0;i<b.length;i++){j=b[i];if(this.types.keyboard&&~this.types.keyboard.indexOf(j))h=this.core.keyboard.addEvent(j,d),a.events[j]===c&&(a.events[j]={}),a.events[j][h]=d;else for(k in this.pointers)this.pointers[k](j,function(b){return function(f,i){a.events[b]===c&&(a.events[b]={}),g=function(g,h){if(!!a.drawn)if(a.isPointerInside()&&!h){if(b!==f+"leave"){if(b===f+"enter"&&a.events[f+"ontarget"])return;if(b===i&&(e.pointer.start_pos.x<0||e.pointer.start_pos.y<0||!a.isPointerInside(e.pointer.start_pos)))return;b!=="touchend"&&(a.events[f+"ontarget"]=!0);return{handler:d,obj:a.nodeName!==c?e:a,eventObject:g}}}else if(b===f+"leave"&&a.events[f+"ontarget"]){a.events[f+"ontarget"]=!1;return{handler:d,obj:a,eventObject:g}}},h=e[f].addEvent(b,g),a.events[b][h]=d}}(j))}},unbind:function(a,b,d){var e,f,g,h,i,j;b=b.split(" ");for(e=0;e<b.length;e++){f=b[e];if(a.events[f]===c)continue;for(g in this.types)if(~this.types[g].indexOf(f)){h=g;break}for(i in a.events[f])if(a.events[f][i]===d){j=i;break}j!==c&&(delete a.events[f][j],this.core[h].removeEvent(f,j))}},trigger:function(a,b){var d,e,f,g;b=b.split(" ");for(d=0;d<b.length;d++){e=b[d],g=a.events[e];if(g!==c)for(f in g)~this.types.keyboard.indexOf(e)?g[f].call(a,this.core.keyboard.last_event):g[f].call(a,this.core.pointer.last_event);else~e.indexOf("cancel")&&this.core[e.replace("cancel","")].cancel()}},triggerPointerHandlers:function(a,b,d){var e,f,g,h,i=a.length,j=-1,k=[],l=[],m=[],n;for(f in a)e=a[f],typeof e=="function"&&(h=e(b,d),h!==c&&k.push(h));for(g=0;g<k.length;g++)k[g].obj===this.core?l.push(k[g]):k[g].obj.zIndex>j?(j=k[g].obj.zIndex,m=[k[g]]):k[g].obj.zIndex===j&&m.push(k[g]);if(m.length>0)for(g=0;g<m.length;g++)n=m[g],n.handler.call(n.obj,n.eventObject);for(g=0;g<l.length;g++)n=l[g],n.handler.call(n.obj,n.eventObject)},modifyEventObject:function(a,b){var d="altKey ctrlKey metaKey shiftKey button charCode keyCode clientX clientY layerX layerY pageX pageY screenX screenY detail eventPhase isChar touches targetTouches changedTouches scale rotation".split(" "),e=d.length,f,g,h;f={originalEvent:a,type:b,timeStamp:(new Date).getTime(),which:a.which===0?a.keyCode:a.which,preventDefault:function(){a.preventDefault()},stopPropagation:function(){a.stopPropagation()}};for(g=0;g<e;g++)h=d[g],a[h]!==c&&(f[h]=a[h]);return f}}};d.registerModule("events",j,"init");var k=function(){return{objects:[],translation:{x:0,y:0},add:function(a){return this.objects.push(a)-1},remove:function(a){var b;typeof a!="number"?b=this.objects.indexOf(a):b=a;this.objects[b]!==c&&(this.objects[b].drawn=!1,this.objects.splice(b,1),this.redraw())},changeZorder:function(a,b){var d=this.objects,e=d[a],f=d[b],g,h,i,j;if(e!==c){if(a===b)return;b>d.length-1&&(b=d.length-1),b<0&&(b=0),b>a?(g=d.slice(0,a),i=d.slice(b+1,d.length),h=d.slice(a,b+1),h.shift(),h.push(e)):(g=d.slice(0,b),i=d.slice(a+1,d.length),h=d.slice(b,a+1),h.pop(),h.unshift(e)),this.objects=g.concat(h).concat(i)}},clear:function(a){var b=this.objects,d=b.length,e;a===c||a===!0?this.core.background.redraw():this.core.canvas.clearRect(0,0,this.core.width,this.core.height);for(e=0;e<d;e++)b[e].drawn=!1;return this},redraw:function(a){a=a||!1;var b=this.core.canvas,d=this.objects,e=d.length,f,g,h,i,j,k,l,m,n,o,p,q;(this.core.settings.clearEachFrame||a)&&this.clear();for(f=0;f<e;f++){g=d[f];if(g!==c&&typeof g.draw=="function"){typeof g.update=="function"&&g.update(),b.save(),k=[],k.push(g),p=g.parent;while(p)k.push(p),p=p.parent;k.reverse(),l=0,m=0;for(n=0,o=k.length;n<o;n++)h=k[n],b.translate(h.abs_x-l,h.abs_y-m),h.rotation!==0&&b.rotate(h.rotation*Math.PI/180),(h.scalingX!==1||h.scalingY!==1)&&b.scale(h.scalingX,h.scalingY),l=h.abs_x,m=h.abs_y;this.translation={x:l,y:m},i=g.abs_x,j=g.abs_y,g._.abs_x=0,g._.abs_y=0,b.globalAlpha=isNaN(parseFloat(g.opacity))?1:parseFloat(g.opacity),b.globalCompositeOperation=g.composition,q=g.shadow,q.blur>0&&(b.shadowOffsetX=q.offsetX,b.shadowOffsetY=q.offsetY,b.shadowBlur=q.blur,b.shadowColor=q.color),b.lineCap=g.cap,b.lineJoin=g.join,b.miterLimit=g.miterLimit,g.draw(),g.drawn=!0,g._.abs_x=i,g._.abs_y=j,b.lineCap="butt",b.lineJoin="miter",b.miterLimit=10,b.restore(),this.translation={x:0,y:0}}}return this}}};d.registerModule("draw",k);var m=function(){return{bg:"",value:"",type:"transparent",loaded:!1,init:function(){this.set(this.core.settings.background)},set:function(a){var b=this;typeof a!="string"&&(a=""),this.value=a,~a.indexOf("gradient")?this.type="gradient":~a.indexOf("image")?this.type="image":this.core.style&&this.core.style.isColor(a)?this.type="color":this.type="transparent";if(this.type==="color")this.bg=a,this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if(this.type==="gradient")this.bg=this.core.style?this.core.style.getGradient(a,0,0,this.core.width,this.core.height):"",this.core.timeline&&!this.core.timeline.running&&this.core.draw.redraw(!0),this.loaded=!0;else if(this.type==="image"){var c=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(a),d=c[1],e=c[4]||"repeat",f=new Image;f.src=d,f.onload=function(){b.bg=b.core.canvas.createPattern(this,e),b.loaded=!0,b.core.timeline&&!b.core.timeline.running&&b.core.redraw(!0)}}else this.redraw(!0),this.loaded=!0;return this},redraw:function(a){var b=this.core;this.type!=="transparent"?(b.canvas.fillStyle=this.bg,b.canvas.fillRect(0,0,b.width,b.height)):b.canvas.clearRect(0,0,b.width,b.height)}}};d.registerModule("background",m,"init");var o=function(){return{current:"none",scenes:{},create:function(a,b){this.scenes[a]=Object.create(this.scenesBase()),this.scenes[a].name=a,b.call(this.scenes[a]);return this.scenes[a]},scenesBase:function(){return{name:"",objects:[],loaded:!1,add:function(a){this.objects.push(a),this.loaded&&a.add();return this},remove:function(a){var b=this.objects.indexOf(a);~b&&(this.objects.splice(b,1),this.loaded&&a.remove());return this},load:function(){if(!this.loaded){var a=this.objects,b,d=a.length;for(b=0;b<d;b++)a[b]!==c&&a[b].add();this.loaded=!0;return this}},unload:function(){var a=this.objects,b,d=a.length;for(b=0;b<d;b++)a[b]!==c&&a[b].remove();this.loaded=!1;return this}}},load:function(a,b){b===!0&&this.current!=="none"&&this.unload(this.current),this.current=a,this.scenes[a].load();return this},unload:function(a){this.current="none",this.scenes[a].unload();return this}}};d.registerModule("scenes",o);var p=function(){return{getStroke:function(a,b){b=b==="string"?"string":"object";if(typeof a=="object"&&b==="string"){var c=a;a=typeof c.pos=="string"?c.pos:"center",a+=" "+(typeof c.width=="number"?c.width+"px":"1px"),a+=" "+(typeof c.color=="string"?c.color:"#000000")}var d=a.split(" "),e=["outside","center","inside"],f="",g,h=d.length,i,j,k,l;if(h>=3)if(!~e.indexOf(d[0])){l=isNaN(parseInt(d[0]));for(g=l?0:1;g<h;g++)f+=d[g]+(g===h-1?" ":"");l?d=[1,f]:d=[d[0],f],h=2}else{if(h>3){for(g=2;g<h;g++)f+=d[g]+(g===h-1?" ":"");d=[d[0],d[1],f]}d={pos:d[0],width:parseInt(d[1]),color:d[2]}}h===2&&(d={pos:"center",width:parseInt(d[0]),color:d[1]}),d.length&&(d={pos:"center",width:0,color:""});if(b==="string")return d.pos+" "+d.width+"px "+d.color;if(b==="object")return d},getGradient:function(a,b,c,d,e){return~a.indexOf("linear")?this.getLinearGradient(a,b,c,d,e):~a.indexOf("radial")?this.getRadialGradient(a,b,c,d,e):"transparent"},getLinearGradient:function(a,b,c,d,e){var f,g,h,i=[],j,k,l,m,n,o,p=["top","bottom","left","right"],q,r,s=[],t,u;g=/\((.*)\)/.exec(a)[1];while(q=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(g))r=s.push(q[1])-1,g=g.substring(0,q.index)+"###"+r+"###"+g.substring(q.index+q[1].length,g.length);g=g.split(","),h=g[0].split(" "),(~p.indexOf(h[0])||~h[0].indexOf("deg"))&&i.push(h[0]),h.length>1&&~p.indexOf(h[1])&&i.push(h[1]),i.length===0?i.push("top"):k=1;if(i.length===1){if(i[0]==="top")l=b+d/2,m=c,n=b+d/2,o=c+e;else if(i[0]==="right")l=b+d,m=c+e/2,n=b,o=c+e/2;else if(i[0]==="bottom")l=b+d/2,m=c+e,n=b+d/2,o=c;else if(i[0]==="left")l=b,m=c+e/2,n=b+d,o=c+e/2;else if(~i[0].indexOf("deg")){var v,w,x,y,z,A,B,C,D=Math.PI,E=b+d/2,F=c+e/2;v=parseFloat(i)%360*D/180,w=v,v>=0&&v<D/2?(A=b+d,B=c):v>=D/2&&v<D?(C=F,F=E,B=b,A=C,E=c):v>=D&&v<D*1.5?(C=F,A=E,E=b,F=c+e,B=C):v>=D*1.5&&v<D*2&&(C=F,F=b+d,B=E,A=c+e,E=C),v=v%(D/2),x=Math.atan(Math.abs(F-B)/Math.abs(A-E)),y=Math.sqrt(Math.pow(F-B,2)+Math.pow(E-A,2)),z=y*Math.cos(x-v),w>=0&&w<D/2?(n=E+z*Math.cos(v),o=F-z*Math.sin(v),l=E*2-n,m=F*2-o):w>=D/2&&w<D?(n=F-z*Math.cos(D/2-v),o=A-z*Math.sin(D/2-v),l=F*2-n,m=A*2-o):w>=D&&w<D*1.5?(n=A+z*Math.cos(D-v),o=B+z*Math.sin(D-v),l=A*2-n,m=B*2-o):w>=D*1.5&&w<D*2&&(n=B-z*Math.cos(D*1.5-v),o=E-z*Math.sin(D*1.5-v),l=B*2-n,m=E*2-o)}}else~i.indexOf("top")&&~i.indexOf("left")?(l=b,m=c,n=b+d,o=c+e):~i.indexOf("top")&&~i.indexOf("right")?(l=b+d,m=c,n=b,o=c+e):~i.indexOf("bottom")&&~i.indexOf("left")?(l=b,m=c+e,n=b+d,o=c):~i.indexOf("bottom")&&~i.indexOf("right")&&(l=b+d,m=c+e,n=b,o=c);f=this.core.canvas.createLinearGradient(l,m,n,o),t=this.getColorStops(f,g.slice(k),s);for(u=0;u<t.length;u++)f.addColorStop(t[u].pos/100,t[u].color);return f},getRadialGradient:function(a,b,d,e,f){var g,h=["left","center","right"],i=["top","center","bottom"],j={left:b,center:b+e/2,right:b+e},k={top:d,center:d+f/2,bottom:d+f},l=["closest-side","closest-corner","farthest-side","farthest-corner","contain","cover"],m,n,o,p,q,r=[],s,t,u,v=0,w=[{x:c,y:c,r:0},{x:c,y:c,r:c}],x,y,z,A,B=!1;m=/\((.*)\)/.exec(a)[1];while(p=/((hsl|hsla|rgb|rgba)\(.*?\))/.exec(m))q=r.push(p[1])-1,m=m.substring(0,p.index)+"###"+q+"###"+m.substring(p.index+p[1].length,m.length);m=m.split(/\s*,\s*/),o=m.length;for(n=0;n<2;n++)if(~m[n].indexOf(" ")){u=m[n].split(" ");if(u[0]==="center")w[n].x=u[0],w[n].y=u[1],v=n+1;else if(~h.indexOf(u[0]))w[n].x=u[0],v=n+1,~i.indexOf(u[1])&&(w[n].y=u[1]);else if(~i.indexOf(u[0]))w[n].y=u[0],v=n+1,~h.indexOf(u[1])&&(w[n].x=u[1]);else if(!isNaN(parseFloat(u[0]))){w[n].x=u[0],v=n+1;if(~i.indexOf(u[1])||!isNaN(parseFloat(u[1])))w[n].y=u[1]}w[n].x||(w[n].x="center"),w[n].y||(w[n].y="center")}else~h.indexOf(m[n])?(w[n].x=m[n],v=n+1):~i.indexOf(m[n])?(w[n].y=m[n],v=n+1):n===1?w[n].x=w[0].x:w[n].x="center",n===1?w[n].y=w[0].y:w[n].y="center";~l.indexOf(m[v])&&(A=m[v],B=!0),/\d+(%|px)\s/.test(m[v])&&(A=parseFloat(m[v]),B=!0,isNaN(A)&&(A=0)),A===c&&(A="cover");for(n=0;n<2;n++){w[n].abs_x=j[w[n].x],w[n].abs_y=k[w[n].y];for(x=0;x<2;x++)y="abs_"+(x===0?"x":"y"),w[n][y]===c&&(w[n][y]=parseFloat(w[n][y==="abs_x"?"x":"y"]),isNaN(w[n][y])&&(w[n][y]=y==="abs_x"?j.center-b:k.center-d),~w[n][y==="abs_x"?"x":"y"].indexOf("%")&&(w[n][y]=w[n][y]/100*(y==="abs_x"?e:f)),w[n][y]+=y==="abs_x"?b:d)}~l.indexOf(A)&&(A==="closest-side"||A==="contain"?A=Math.min(Math.abs(w[1].abs_y-d),Math.abs(d+f-w[1].abs_y),Math.abs(w[1].abs_x-b),Math.abs(b+e-w[1].abs_y)):A==="closest-corner"?A=Math.min(Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(d+f-w[1].abs_y,2)),Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(d+f-w[1].abs_y,2))):A==="farthest-corner"||A==="cover"?A=Math.max(Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(w[1].abs_y-d,2)),Math.sqrt(Math.pow(b+e-w[1].abs_x,2)+Math.pow(d+f-w[1].abs_y,2)),Math.sqrt(Math.pow(w[1].abs_x-b,2)+Math.pow(d+f-w[1].abs_y,2))):A==="farthest-side"?A=Math.max(Math.abs(w[1].abs_y-d),Math.abs(d+f-w[1].abs_y),Math.abs(w[1].abs_x-b),Math.abs(b+e-w[1].abs_y)):A=0),~m[v].indexOf("%")&&(~m[v].indexOf(" ")?z=m[v].split(" ")[1]==="height"?f:e:z=e,A=A/100*z),w[1].r=A,g=this.core.canvas.createRadialGradient(w[0].abs_x,w[0].abs_y,w[0].r,w[1].abs_x,w[1].abs_y,w[1].r),s=this.getColorStops(g,m.slice(v+(B?1:0)),r);for(t=0;t<s.length;t++)g.addColorStop(s[t].pos/100,s[t].color);return g},getColorStops:function(a,b,d){var e,f=b.length,g,h,i,j,k=[];for(e=0;e<f;e++){g=b[e].trim();if(j>=100)break;~g.indexOf(" ")?(h=g.split(" "),i=h[0],j=h[1],~j.indexOf("px")?j=parseFloat(j)/Math.sqrt(Math.pow(eX-sX,2)+Math.pow(eY-sY,2))*100:j=parseFloat(j)):(i=g,j===c?j=0:j=j+(100-j)/(f-e)),~i.indexOf("###")&&(i=d[/###(\d+)###/.exec(i)[1]]),k.push({pos:j,color:i})}return k},getFont:function(a,b){b=b==="string"?"string":"object";if(typeof a=="object"&&b==="string"){var c=a;a=typeof c.style=="string"?c.style:"normal",a+=" "+(typeof c.variant=="string"?c.variant:"normal"),a+=" "+(typeof c.weight=="string"?c.weight:"normal"),a+=" "+(typeof c.size=="number"?~~(c.size*10+.5)/10+"px":"16px"),a+="/"+(typeof c.lineHeight=="number"?~~(c.lineHeight*10+.5)/10:1.5),a+=" "+(typeof c.family=="string"?c.family:"sans-serif")}if(a.length>0){var d=a.split(" "),e=d.length,f,a,g,h,i="",j=["normal","italic","oblique"],k=["normal","small-caps"],l=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],m={};for(f=0;f<e;f++){a=d[f];if(~j.indexOf(a)&&!m.style)m.style=a;else if(~k.indexOf(a)&&!m.variant)m.variant=a;else if(~l.indexOf(a)&&!m.weight)m.weight=a;else if(~a.indexOf("/")&&!m.size&&!m.lineHeight)g=a.split("/"),isNaN(parseInt(g[0]))||(m.size=parseInt(g[0])),isNaN(parseFloat(g[1]))||(m.lineHeight=parseFloat(g[1]));else if(!m.size&&/\d+[a-z]{2}(?!\/)/.test(a))isNaN(parseInt(a))||(m.size=parseInt(a));else if(isNaN(parseInt(a))&&!m.family){i="";for(h=f;h<e;h++)i+=d[h]+(h===e-1?"":" ");m.family=i}}}d=m||{},d.style=d.style?d.style:"normal",d.variant=d.variant?d.variant:"normal",d.weight=d.weight?d.weight:"normal",d.size=d.size?d.size:16,d.lineHeight=d.lineHeight?d.lineHeight:1,d.family=d.family?d.family:"sans-serif";if(b==="string")return d.style+" "+d.variant+" "+d.weight+" "+d.size+"px/"+d.lineHeight+" "+d.family;if(b==="object")return d},getShadow:function(a,b){var c={},d;if(typeof a=="object")c.offsetX=isNaN(parseFloat(a.offsetX))?0:parseFloat(a.offsetX),c.offsetY=isNaN(parseFloat(a.offsetY))?0:parseFloat(a.offsetY),c.blur=isNaN(parseFloat(a.blur))?0:parseFloat(a.blur),c.color=this.isColor(a.color)?a.color:"#000";else if(typeof a=="string"){var d=/^(.*?)\s(.*?)\s(.*?)\s(.*?)$/.exec(a);c.offsetX=isNaN(parseFloat(d[1]))?0:parseFloat(d[1]),c.offsetY=isNaN(parseFloat(d[2]))?0:parseFloat(d[2]),c.blur=isNaN(parseFloat(d[3]))?0:parseFloat(d[3]),c.color=this.isColor(d[4])?d[4]:"#000"}return b==="string"?c.offsetX+"px "+c.offsetY+"px "+c.blur+"px "+c.color:c},isColor:function(a){return typeof a!="string"||a[0]!=="#"&&a.substr(0,4)!=="rgb("&&a.substr(0,5)!=="rgba("&&a.substr(0,4)!=="hsl("&&a.substr(0,5)!=="hsla("?!1:!0}}};d.registerModule("style",p);var q=function(){return{durations:{"short":500,normal:1e3,"long":2e3},defaults:{duration:"normal",easing:"ease-in-out"},queue:{activeAnimations:{},timers:{},lastID:0},easing:{"ease-in":function(a){return this.cubicBezier(.42,0,1,1,a)},"ease-out":function(a){return this.cubicBezier(0,0,.58,1,a)},"ease-in-out":function(a){return this.cubicBezier(.42,0,.58,1,a)},linear:function(a){return a},cubicBezier:function(a,b,c,d,e){var f=0,g=0,h=1,i=1,j=h-3*c+3*a-f,k=3*c-6*a+3*f,l=3*a-3*f,m=f,n=i-3*d+3*b-g,o=3*d-6*b+3*g,p=3*b-3*g,q=g,r=e,s=5,t,u,v,w;for(t=0;t<s;t++)v=j*r*r*r+k*r*r+l*r+m,u=1/(3*j*r*r+2*k*r+l),r-=(v-e)*u,r=r>1?1:r<0?0:r;w=Math.abs(n*r*r*r+o*r*r+p*r*q);return w}},animate:function(a,b,d,e){function t(a){return typeof a=="function"?a:j}function s(a,c){if(typeof a=="function"&&c===b.length-2)return a;if(this.easing[a])return this.easing[a];if(typeof a=="string"&&~a.indexOf("cubic-bezier")){var d,e,f,g,h;h=a.match(/cubic-bezier\(\s*(.*?),\s*(.*?),\s*(.*?),\s*(.*?)\)/),d=isNaN(parseFloat(h[1]))?0:parseFloat(h[1]),e=isNaN(parseFloat(h[2]))?0:parseFloat(h[2]),f=isNaN(parseFloat(h[3]))?1:parseFloat(h[3]),g=isNaN(parseFloat(h[4]))?1:parseFloat(h[4]);return function(a){return this.cubicBezier(d,e,f,g,a)}}return i}function r(a){return this.durations[a]?this.durations[a]:isNaN(parseInt(a))?this.durations[h]:parseInt(a)}b=Array.prototype.slice.call(b),d=d||!1,e=e||!1;if(b[0].constructor!==Object)return!1;this.queue[a.id]||(this.queue[a.id]=[]);var f=this,g=b[0],h=this.defaults.duration,i=this.easing[this.defaults.easing],j=function(){},k=this.queue,l=k[a.id],m,n,o={},p=0,q=this.queue.timers;q[a.id]===c&&(q[a.id]=0);if(d!==!0){l.push({id:++k.lastID,start:function(){f.animate(a,b,!0,this.id)}});if(!k.activeAnimations[a.id]){k.activeAnimations[a.id]=l[0].id,l[0].start(),l.splice(0,1);return}}else{h=r.call(this,b[1]),i=s.call(this,b[1],1),i=s.call(this,b[2],2),j=t.call(this,b[1]),j=t.call(this,b[2]),j=t.call(this,b[3]);for(m in g)o[m]=a[m];(function u(){var b,d,m,n,r;p+=1e3/f.core.settings.fps,q[a.id]=p;for(b in g){d=g[b],m=o[b],r=i.call(f.easing,p/h)*(d-m)+m;if(m<d&&r<=d||m>d&&r>=d)a[b]=r}if(q[a.id]<h&&k.activeAnimations[a.id]===e)f.core.timeline.running||f.core.draw.redraw(!0),setTimeout(u,1e3/f.core.settings.fps);else if(k.activeAnimations[a.id]===e){for(b in g)a[b]=g[b];f.core.timeline.running||f.core.draw.redraw(!0),k.activeAnimations[a.id]=!1,j.call(a);if(l[0]!==c){k.activeAnimations[a.id]=l[0].id,l[0].start(),l.splice(0,1);return}}})()}},stop:function(a){this.queue[a]!==c&&(this.queue.activeAnimations[a]=!1,delete this.queue[a],this.core.timeline.running||this.core.draw.redraw(!0))},finish:function(a){this.queue.timers[a]=Infinity}}};d.registerModule("animation",q);var r=function(){var a=function(a,b,c,d,e){var f=e.style.getStroke(a.stroke);f[b]=c,a.stroke=e.style.getStroke(f,"string")};return{id:0,shapeType:"rectangular",type:"",origin:{x:0,y:0},drawn:!1,events:{},children:[],opacity:1,rotation:0,composition:"source-over",scalingX:1,scalingY:1,_:{x:0,y:0,abs_x:0,abs_y:0,rotation:0,width:0,height:0,stroke:"",strokeColor:"",strokeWidth:0,strokePosition:"center",cap:"butt",join:"miter",miterLimit:10,fill:"",shadow:{offsetX:0,offsetY:0,blur:0,color:"transparent"}},set strokeColor(b){a(this,"color",b,"strokeColor",this.core)},set strokeWidth(b){a(this,"width",b,"strokeWidth",this.core)},set strokePosition(b){a(this,"pos",b,"strokePosition",this.core)},set stroke(a){typeof a!="string"&&(a=this.core.style.getStroke(a,"string"));var b=this.core.style.getStroke(a);if(~b.color.indexOf("image(")){var c=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(b.color),d=c[1],e=c[4]||"repeat",f=new Image,g=this;f.src=d,this._.strokepattern_loading=!0,this._.strokepattern_redraw=!1,f.onload=function(){g._.strokeColor=g.core.canvas.createPattern(this,e),g._.strokepattern_loading=!1,g._.strokepattern_redraw&&(g._.strokepattern_redraw=!1,g.redraw())}}else this._.strokeColor=b.color;this._.strokeWidth=b.width,this._.strokePosition=b.pos,this._.stroke=a},set cap(a){var b=["butt","round","square"];this._.cap=~b.indexOf(a)?a:"butt"},set join(a){var b=["round","bevel","miter"];this._.join=~b.indexOf(a)?a:"miter"},set miterLimit(a){this._.miterLimit=isNaN(parseFloat(a))?10:parseFloat(a)},get stroke(){return this._.stroke},get strokeColor(){if(this._.strokepattern_loading){this._.strokepattern_redraw=!0;return""}if(~(this._.strokeColor+"").indexOf("CanvasPattern"))return this._.strokeColor;if(!~this._.strokeColor.indexOf("gradient"))return this._.strokeColor;var a=this.getOrigin();if(this.shapeType==="rectangular"){var b=this.strokePosition==="outside"?this.strokeWidth:this.strokePosition==="center"?this.strokeWidth/2:0;return this.core.style.getGradient(this._.strokeColor,this.abs_x-a.x-b,this.abs_y-a.y-b,this.width+b*2,this.height+b*2)}if(this.shapeType==="radial"){var c=this.radius+this.strokeWidth/2;a.x+=this.radius,a.y+=this.radius;return this.core.style.getGradient(this._.strokeColor,this.abs_x-a.x-this.radius,this.abs_y-a.y-this.radius,c*2,c*2)}},get strokeWidth(){return this._.strokeWidth},get strokePosition(){return this._.strokePosition},get cap(){return this._.cap},get join(){return this._.join},get miterLimit(){return this._.miterLimit},set fill(a){if(~a.indexOf("image(")){var b=/image\((.*?)(,(\s|)(repeat|repeat-x|repeat-y|no-repeat)|)\)/.exec(a),c=b[1],d=b[4]||"repeat",e=new Image,f=this;e.src=c,this._.pattern_loading=!0,this._.pattern_redraw=!1,e.onload=function(){f._.fill=f.core.canvas.createPattern(this,d),f._.pattern_loading=!1,f._.pattern_redraw&&(f._.pattern_redraw=!1,f.redraw())}}else this._.fill=a},get fill(){if(this._.pattern_loading){this._.pattern_redraw=!0;return""}if(~(this._.fill+"").indexOf("CanvasPattern"))return this._.fill;if(!~this._.fill.indexOf("gradient"))return this._.fill;var a=this.getOrigin();if(this.shapeType==="rectangular")return this.core.style.getGradient(this._.fill,this.abs_x-a.x,this.abs_y-a.y,this.width,this.height);if(this.shapeType==="radial")return this.core.style.getGradient(this._.fill,this.abs_x-a.x-this.radius,this.abs_y-a.y-this.radius,this.radius*2,this.radius*2)},set shadow(a){typeof a!="string"&&(a=this.core.style.getShadow(a,"string"));var b=this.core.style.getShadow(a);this._.shadow=b},set shadowOffsetX(a){isNaN(parseFloat(a))||(this._.shadow.offsetX=parseFloat(a))},set shadowOffsetY(a){isNaN(parseFloat(a))||(this._.shadow.offsetY=parseFloat(a))},set shadowBlur(a){isNaN(parseFloat(a))||(this._.shadow.blur=parseFloat(a))},set shadowColor(a){this.core.style.isColor(a)&&(this._.shadow.color=a)},get shadow(){return this._.shadow},get shadowOffsetX(){return this._.shadow.offsetX},get shadowOffsetY(){return this._.shadow.offsetY},get shadowBlur(){return this._.shadow.blur},get shadowColor(){return this._.shadow.color},set x(a){this._.x=a,this._.abs_x=a+(this.parent!==c?this.parent.abs_x:0);var b=this.children,d=b.length,e;for(e=0;e<d;e++)b[e]._.abs_x=this.abs_x+b[e].x,b[e].x+=0},set y(a){this._.y=a,this._.abs_y=a+(this.parent!==c?this.parent.abs_y:0);var b=this.children,d=b.length,e;for(e=0;e<d;e++)b[e]._.abs_y=this.abs_y-b[e].y,b[e].y+=0},get x(){return this._.x},get y(){return this._.y},set abs_x(a){return},set abs_y(a){return},get abs_x(){return this._.abs_x},get abs_y(){return this._.abs_y},set width(a){var b=this._.width;this._.width=a;var c=this.children,d=c.length,e;for(e=0;e<d;e++)c[e].type!=="image"&&(c[e].width=c[e].width-b+a)},get width(){return this._.width},set height(a){var b=this._.height;this._.height=a;var c=this.children,d=c.length,e;for(e=0;e<d;e++)c[e].type!=="image"&&(c[e].height=c[e].height-b+a)},get height(){return this._.height},set zIndex(a){a==="front"&&(a=this.core.draw.objects.length-1),a==="back"&&(a=0),this.core.draw.changeZorder(this.zIndex,a);var b=this.children,c=b.length,d;for(d=0;d<c;d++)b[d].zIndex=a+d+1},get zIndex(){return this.core.draw.objects.indexOf(this)},bind:function(a,b){this.core.events.bind(this,a,b);return this},unbind:function(a,b){this.core.events.unbind(this,a,b);return this},trigger:function(a){this.core.events.trigger(this,a);return this},add:function(a){if(this.drawn===!1){a=a!==c?a:!0,this.core.draw.add(this),this.drawn=!0,a&&this.core.redraw();var b=this.children,d=b.length,e;for(e=0;e<d;e++)b[e].add(a)}return this},remove:function(){this.core.draw.remove(this),this.drawn=!1;var a=this.children,b=a.length,c;for(c=0;c<b;c++)a[c].remove();return this},draw:function(){},redraw:function(){this.core.draw.redraw();return this},rotate:function(a){this.rotation+=a;return this},rotateTo:function(a){this.rotation=a;return this},getArgs:function(a,b,d,e){d=d||0,e=e||0;if(typeof b=="string"){var f=b,g=a;a=f==="x"?g:d,b=f==="y"?g:e}else b===c&&(b=a);return{x:a,y:b}},move:function(a,b){var c=this.getArgs(a,b);this.x+=c.x,this.y+=c.y;return this},moveTo:function(a,b){var c=this.getArgs(a,b,this.x,this.y);this.x=c.x,this.y=c.y;return this},scale:function(a,b){var c=this.getArgs(a,b,1,1);this.scalingX=c.x,this.scalingY=c.y;return this},scaleTo:function(a,b){var c=this.shapeType==="rectangular"?this.width:this.radius,d=this.shapeType==="rectangular"?this.height:this.radius,e=this.getArgs(a,b,c,d);e.x=e.x<=0?1:e.x,e.y=e.y<=0?1:e.y,this.scalingX=e.x/c,this.scalingX=e.y/d;return this},animate:function(){this.core.animation.animate(this,arguments);return this},stop:function(){this.core.animation.stop(this.id);return this},finish:function(){this.core.animation.finish(this.id);return this},fadeIn:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:1}].concat(a));return this},fadeOut:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:0}].concat(a));return this},fadeTo:function(){var a=Array.prototype.slice.call(arguments);this.core.animation.animate(this,[{opacity:a.splice(0,1)[0]}].concat(a));return this},dragAndDrop:function(a){a=a===c?{}:a;if(a===!1&&this.draggable===!0)this.draggable=!1,this.unbind("mousedown touchstart",this._.drag_start),this.core.unbind("mouseup touchend",this._.drag_end),this.core.unbind("mousemove touchmove",this._.drag_move);else if(!this.draggable){this.draggable=!0,this.dragging=!1;var b=this,d={x:0,y:0};this._.drag_start=function(b){this.dragging=!0,d.x=b.x-this.x,d.y=b.y-this.y,a.changeZindex===!0&&(this.zIndex="front"),typeof a.start=="function"&&a.start.call(this),this.core.timeline.running||this.core.draw.redraw()},this._.drag_end=function(){b.dragging&&(b.dragging=!1,typeof a.end=="function"&&a.end.call(b),b.core.timeline.running||b.core.draw.redraw())},this._.drag_move=function(c){b.dragging&&(b.x=c.x-d.x,b.y=c.y-d.y,typeof a.move=="function"&&a.move.call(b),b.core.timeline.running||b.core.draw.redraw())},this.bind("mousedown touchstart",this._.drag_start),this.core.bind("mouseup touchend",this._.drag_end),this.core.bind("mousemove touchmove",this._.drag_move)}return this},setOrigin:function(a,b){this.origin.x=a,this.origin.y=b;return this},getOrigin:function(){var a,b,c=this.origin,d=this.shapeType;c.x==="center"?a=d==="rectangular"?this.width/2:0:c.x==="right"?a=d==="rectangular"?this.width:this.radius:c.x==="left"?a=d==="rectangular"?0:-this.radius:a=isNaN(parseFloat(c.x))?0:parseFloat(c.x),c.y==="center"?b=d==="rectangular"?this.height/2:0:c.y==="bottom"?b=d==="rectangular"?this.height:this.radius:c.y==="top"?b=d==="rectangular"?0:-this.radius:b=isNaN(parseFloat(c.y))?0:parseFloat(c.y);return{x:a,y:b}},addChild:function(a,b){if(a.parent===c){var d=this.children.push(a)-1;a.parent=this,a.x+=0,a.y+=0,this.drawn&&a.add();if(b)return d}else if(b)return!1;return this},removeChild:function(a){var b=this.children.indexOf(a);~b&&this.removeChildAt(b);return this},removeChildAt:function(a){this.children[a]!==c&&(this.children[a].remove(),this.children[a].parent=c,this.children.splice(a,1));return this},clone:function(a){a=a||{},a.drawn=!1;var b=this.core.display[this.type](a),e={},f=["core","events","children","parent","img","fill","strokeColor"],g,h,i,j,k,l,m,n,o;g=function(a,b){for(h in a){if(~f.indexOf(h))continue;if(typeof a[h]=="object"){b[h]=a[h].constructor===Array?[]:{},g(a[h],b[h]);continue}o=Object.getOwnPropertyDescriptor(a,h),o&&o.get===c&&(b[h]=a[h])}},g(this,e),e.fill=this._.fill,i=this.core.style.getStroke(this.stroke),e.strokeColor=i.color,b=d.extend(b,e,a),typeof b.init=="function"&&b.init(),k=this.children;if(k.length>0)for(j=0;j<k.length;j++)l=k[j].clone(),b.children.push(l),l.parent=b,a.x&&(m=Math.abs(k[j].abs_x-this.x),l.x=m),a.y&&(n=Math.abs(k[j].abs_y-this.y),l.y=n);return b},isPointerInside:function(a){return this.core.tools.isPointerInside(this,a)}}},s=function(a,b,e,f){var g=this,h=this.core,i=function(c,f){return d.extend({core:f,type:a,shapeType:"rectangular",draw:function(){e.call(this,h.canvas,h);return this}},b,c)};this[a]=function(b){var e=d.extend(Object.create(r()),new i(b,h));f!==c&&typeof g[a][f]=="function"&&g[a][f]();return e};return g};d.registerModule("displayObject",r),d.registerModule("display",{wrapper:!0,register:s}),d.registerDisplayObject=function(a,b,e){d.registerModule("display."+a,{setCore:function(f){return function(g){var h=d.extend(Object.create(r()),new b(g,f));h.type=a,h.id=++f.lastObjectID,e!==c&&h[e]();return h}}})};var t=function(a,b){return d.extend({core:b,shapeType:"rectangular",draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;a.beginPath(),this.fill!==""&&(a.fillStyle=this.fill,a.fillRect(c,d,this.width,this.height)),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,this.strokePosition==="outside"?a.strokeRect(c-this.strokeWidth/2,d-this.strokeWidth/2,this.width+this.strokeWidth,this.height+this.strokeWidth):this.strokePosition==="center"?a.strokeRect(c,d,this.width,this.height):this.strokePosition==="inside"&&a.strokeRect(c+this.strokeWidth/2,d+this.strokeWidth/2,this.width-this.strokeWidth,this.height-this.strokeWidth)),a.closePath();return this}},a)};d.registerDisplayObject("rectangle",t);var u=function(a,b){return d.extend({core:b,shapeType:"rectangular",loaded:!1,firstDrawn:!1,tile:!1,tile_width:0,tile_height:0,tile_spacing_x:0,tile_spacing_y:0,init:function(){var a=this,b;this.image!==c&&(b=this.image.nodeName&&this.image.nodeName.toLowerCase()==="img"?"htmlImg":"newImg",this.img=b==="htmlImg"?this.image.cloneNode(!1):new Image,this.core.canvasElement.appendChild(this.img),this.img.onload=function(){a.loaded=!0,a.width!==0?a.height===0&&(a.height=a.width/(this.width/this.height)):a.width=this.width,a.height!==0?a.width===0&&(a.width=a.height/(this.height/this.width)):a.height=this.height,a.tile_width=a.tile_width===0?a.width:a.tile_width,a.tile_height=a.tile_height===0?a.height:a.tile_height,a.core.canvasElement.removeChild(this),a.core.redraw()},b==="newImg"&&(this.img.src=this.image))},draw:function(){var a=this.core.canvas,b=this,d=this.getOrigin(),e=this.abs_x-d.x,f=this.abs_y-d.y,g,h;if(this.loaded&&this.core.draw.objects[this.zIndex]!==c&&this.img.width>0&&this.img.height>0){g=this.width===0?this.img.width:this.width,h=this.height===0?this.img.height:this.height;if(this.tile){var i=Math.ceil(g/this.tile_width),j=Math.ceil(h/this.tile_height),k,l;a.save(),a.beginPath(),a.moveTo(e,f),a.lineTo(e+g,f),a.lineTo(e+g,f+h),a.lineTo(e,f+h),a.lineTo(e,f),a.clip();for(l=0;l<j;l++)for(k=0;k<i;k++)a.drawImage(this.img,e+k*(this.tile_width+this.tile_spacing_x),f+l*(this.tile_height+this.tile_spacing_y),this.tile_width,this.tile_height);a.closePath(),a.restore()}else a.drawImage(this.img,e,f,g,h);this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.strokeRect(e,f,g,h)),this.firstDrawn===!1&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){b.draw()},100);return this}},a)};d.registerDisplayObject("image",u,"init");var v=function(a,c){var e=function(a,b,c,d,e){var f=e.style.getFont(a.font);f[b]=c,a._.font=e.style.getFont(f,"string"),a._[d]=c};return d.extend({core:c,shapeType:"rectangular",align:"start",baseline:"top",_:d.extend({},c.displayObject._,{font:"normal normal normal 16px/1 sans-serif",style:"normal",variant:"normal",weight:"normal",size:16,lineHeight:1,family:"sans-serif",text:"",width:0,height:0}),set font(a){typeof a!="string"&&(a=this.core.style.getFont(a,"string"));var b=this.core.style.getFont(a);a=this.core.style.getFont(b,"string"),this._.style=b.style,this._.variant=b.variant,this._.weight=b.weight,this._.size=b.size,this._.lineHeight=b.lineHeight,this._.family=b.family,this._.font=a,this.initWebFont(),this.setDimensions()},set style(a){e(this,"style",a,"style",this.core),this.initWebFont(),this.setDimensions()},set variant(a){e(this,"variant",a,"variant",this.core),this.initWebFont(),this.setDimensions()},set weight(a){e(this,"weight",a,"weight",this.core),this.initWebFont(),this.setDimensions()},set size(a){e(this,"size",a,"size",this.core),this.initWebFont(),this.setDimensions()},set lineHeight(a){e(this,"lineHeight",a,"lineHeight",this.core),this.initWebFont(),this.setDimensions()},set family(a){e(this,"family",a,"family",this.core),this.initWebFont(),this.setDimensions()},set text(a){this._.text=a,this.initWebFont(),this.setDimensions()},set width(a){return},set height(a){return},get font(){return this._.font},get style(){return this._.style},get variant(){return this._.variant},get weight(){return this._.weight},get size(){return this._.size},get lineHeight(){return this._.lineHeight},get family(){return this._.family},get text(){return this._.text},get width(){return this._.width},get height(){return this._.height},init:function(){this._.initialized=!0,this.initWebFont(),this.setDimensions()},setDimensions:function(){if(this._.initialized){var a=this.core.canvas,b;a.fillStyle=this.fill,a.font=this.font,b=a.measureText(this.text),this._.width=b.width,this._.height=this.size}},initWebFont:function(){var a=this.core,c;c=b.createElement("span"),c.style.font="0px "+this.family,b.body.appendChild(c),setTimeout(function(){b.body.removeChild(c),a.redraw()},1e3)},getBaselineOffset:function(){var a=this.baseline,b;a==="top"?b=this.height*.82:a==="hanging"?b=this.height*.65:a==="middle"?b=this.height*.31:a==="alphabetic"?b=0:a==="ideographic"?b=this.height*-0.05:a==="bottom"&&(b=this.height*-0.22);return b},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.getBaselineOffset(),d=this.abs_x-b.x,e=this.abs_y-b.y+c,f,g;a.beginPath(),a.font=this.font,a.textAlign=this.align,a.textBaseline="alphabetic";if(this.strokeWidth>0){a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,f=(this.text+"").split("\n");for(g=0;g<f.length;g++)a.strokeText(f[g],d,e+g*this.lineHeight*this.height)}if(this.fill!==""){a.fillStyle=this.fill,f=(this.text+"").split("\n");for(g=0;g<f.length;g++)a.fillText(f[g],d,e+g*this.lineHeight*this.height)}a.closePath();return this}},a)};d.registerDisplayObject("text",v,"init");var w=function(a,b){return d.extend({core:b,shapeType:"radial",radius:0,start:0,end:0,direction:"clockwise",draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;this.radius>0&&this.start!==this.end&&(a.beginPath(),a.arc(c,d,this.radius,this.start*Math.PI/180,this.end*Math.PI/180,this.direction==="anticlockwise"),this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke()),a.closePath());return this}},a)};d.registerDisplayObject("arc",w);var x=function(a,b){return d.extend({core:b,shapeType:"radial",_:d.extend({},b.displayObject._,{radius_x:0,radius_y:0}),set radius(a){this._.radius_x=a,this._.radius_y=a},set radius_x(a){this._.radius_x=a},set radius_y(a){this._.radius_y=a},get radius(){return this._.radius_x},get radius_x(){return this._.radius_x},get radius_y(){return this._.radius_y},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y;a.beginPath();if(this.radius_x===this.radius_y)a.arc(c,d,this.radius_x,0,Math.PI*2,!1);else{var e=.276142374915397,f={x:this.radius_x*2*e,y:this.radius_y*2*e};a.moveTo(c-this.radius_x,d),a.bezierCurveTo(c-this.radius_x,d-f.y,c-f.x,d-this.radius_y,c,d-this.radius_y),a.bezierCurveTo(c+f.x,d-this.radius_y,c+this.radius_x,d-f.y,c+this.radius_x,d),a.bezierCurveTo(c+this.radius_x,d+f.y,c+f.x,d+this.radius_y,c,d+this.radius_y),a.bezierCurveTo(c-f.x,d+this.radius_y,c-this.radius_x,d+f.y,c-this.radius_x,d)}this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke()),a.closePath();return this}},a)};d.registerDisplayObject("ellipse",x);var y=function(a,b){return d.extend({core:b,shapeType:"radial",sides:3,_:d.extend({},b.displayObject._,{radius:0,side:0}),set radius(a){this._.radius=a,this._.side=2*this._.radius*Math.sin(Math.PI/this.sides)},set side(a){this._.side=a,this._.radius=this._.side/2/Math.sin(Math.PI/this.sides)},get radius(){return this._.radius},get side(){return this._.side},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.abs_x-b.x,d=this.abs_y-b.y,e={x:0,y:0},f=this.sides,g=this.radius,h,i,j;a.beginPath();for(j=0;j<=f;j++)h=c+g*Math.cos(j*2*Math.PI/f),i=d+g*Math.sin(j*2*Math.PI/f),j===0?(a.moveTo(h,i),e={x:h,y:i}):j==f?a.lineTo(e.x,e.y):a.lineTo(h,i);a.closePath(),this.fill!==""&&(a.fillStyle=this.fill,a.fill()),this.strokeWidth>0&&(a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.stroke());return this}},a)};d.registerDisplayObject("polygon",y);var z=function(a,b){return d.extend({core:b,shapeType:"radial",_:d.extend({},b.displayObject._,{start_x:0,start_y:0,end_x:0,end_y:0,x:200,y:0,abs_x:0,abs_y:0}),children:[],set start(a){this._.start_x=a.x+(this.parent?this.parent._.abs_x:0),this._.start_y=a.y+(this.parent?this.parent._.abs_y:0),this.setPosition()},set end(a){this._.end_x=a.x+(this.parent?this.parent._.abs_x:0),this._.end_y=a.y+(this.parent?this.parent._.abs_y:0),this.setPosition()},get start(){var a={x:0,y:0};this.parent&&(a.x=this.parent._.abs_x,a.y=this.parent._.abs_y);return{x:this._.start_x-a.x,y:this._.start_y-a.y}},get end(){var a={x:0,y:0};this.parent&&(a.x=this.parent._.abs_x,a.y=this.parent._.abs_y);return{x:this._.end_x-a.x,y:this._.end_y-a.y}},set x(a){var b,c,d,e,f;b=this._.end_x-this._.start_x,c=this.parent?this.parent._.abs_x:0,this._.x=a,this._.abs_x=a+c,this._.start_x=a-b/2+c,this._.end_x=a+b/2+c,d=this.children,e=d.length;for(f=0;f<e;f++)d[f]._.abs_x=this.abs_x+d[f].x,d[f].x+=0},set y(a){var b,c,d,e,f;b=this._.end_y-this._.start_y,c=this.parent?this.parent._.abs_y:0,this._.y=a,this._.abs_y=a+c,this._.start_y=a-b/2+c,this._.end_y=a+b/2+c,d=this.children,e=d.length;for(f=0;f<e;f++)d[f]._.abs_y=this.abs_y-d[f].y,d[f].y+=0},get x(){return this._.x},get y(){return this._.y},set length(a){var b,c,d,e;b=Math.abs(this._.end_x-this._.start_x),c=Math.abs(this._.end_y-this._.start_y),d=Math.sqrt(b*b+c*c),e=Math.asin(b/d),b=Math.sin(e)*a,c=Math.cos(e)*a,this._.end_x=this._.start_x+b,this._.end_y=this._.start_y+c,this.x+=0,this.y+=0},get length(){var a,b,c;a=Math.abs(this._.end_x-this._.start_x),b=Math.abs(this._.end_y-this._.start_y),c=Math.sqrt(a*a+b*b);return c},set radius(a){this.length=a*2},get radius(){return this.length/2},setPosition:function(){if(this.initialized){var a={x:0,y:0};this.parent&&(a.x=this.parent._.abs_x,a.y=this.parent._.abs_y),this.x=this._.start_x-a.x+(this._.end_x-this._.start_x)/2,this.y=this._.start_y-a.y+(this._.end_y-this._.start_y)/2}},init:function(){this.initialized=!0,this.setPosition()},draw:function(){var a=this.core.canvas,b=this.getOrigin(),c=this.core.draw.translation;a.lineWidth=this.strokeWidth,a.strokeStyle=this.strokeColor,a.beginPath(),a.moveTo(this._.start_x-c.x-b.x,this._.start_y-c.y-b.y),a.lineTo(this._.end_x-c.x-b.x,this._.end_y-c.y-b.y),a.stroke(),a.closePath();return this}},a)};d.registerDisplayObject("line",z,"init");var A=function(a,b){return d.extend({core:b,shapeType:"rectangular",loaded:!1,firstDrawn:!1,frames:[],duration:0,frame:1,generate:!1,numFrames:0,offset_x:0,offset_y:0,direction:"x",running:!1,active:!1,loop:!0,_:d.extend({},b.displayObject._,{autostart:!1}),set autostart(a){this.active=a,this._.autostart=a},get autostart(){return this._.autostart},init:function(){if(this.image!==c){var a=this,b=this.image.nodeName&&this.image.nodeName.toLowerCase()==="img"?"htmlImg":"newImg";this.img=b==="htmlImg"?this.image.cloneNode(!1):new Image,this.core.canvasElement.appendChild(this.img),this.img.onload=function(){a.full_width=this.width,a.full_height=this.height;if(a.generate){var b,c,d,e,f;b=a.direction,c=b==="y"?a.full_height:a.full_width,d=b==="y"?a.height:a.width,a.numFrames>0?e=a.numFrames:(e=c/d,a.numFrames=e),a.frames=[];for(f=0;f<e;f++)a.frames.push({x:a.offset_x+f*(b==="x"?a.width:0),y:a.offset_y+f*(b==="y"?a.height:0),d:a.duration})}a.core.canvasElement.removeChild(this),a.loaded=!0},b==="newImg"&&(this.img.src=this.image)}},draw:function(){var a=this,b=this.core.canvas,d=this.getOrigin(),e=this.abs_x-d.x,f=this.abs_y-d.y,g;if(this.loaded){if(this.frames.length>0){if(this.frame>this.frames.length)return this;g=this.frames[this.frame-1],frame_width=g.w!==c?g.w:this.width,frame_height=g.h!==c?g.h:this.height,b.drawImage(this.img,g.x,g.y,frame_width,frame_height,e,f,frame_width,frame_height),this.strokeWidth>0&&(b.lineWidth=this.strokeWidth,b.strokeStyle=this.strokeColor,b.strokeRect(e,f,frame_width,frame_height)),this.running===!1&&this.active&&(setTimeout(function(){a.loop?a.frame=a.frame===a.frames.length?1:a.frame+1:a.frame=a.frame===a.frames.length?a.frame:a.frame+1,a.running=!1,a.core.timeline.running||a.core.draw.redraw()},g.d),this.running=!0)}this.firstDrawn===!1&&(this.firstDrawn=!0,clearTimeout(this.loadtimer))}else clearTimeout(this.loadtimer),this.loadtimer=setTimeout(function(){a.draw()},100);return this},start:function(){this.active=!0,this.core.redraw();return this},stop:function(){this.active=!1;return this}},a)};d.registerDisplayObject("sprite",A,"init")})(window,document),function(){"use strict";var a=Object.prototype,b=a.__defineGetter__,c=a.__defineSetter__,d=a.__lookupGetter__,e=a.__lookupSetter__,f=a.hasOwnProperty;b&&c&&d&&e&&(Object.defineProperty||(Object.defineProperty=function(a,g,h){if(arguments.length<3)throw new TypeError("Arguments not optional");g+="";if(f.call(h,"value")){!d.call(a,g)&&!e.call(a,g)&&(a[g]=h.value);if(f.call(h,"get")||f.call(h,"set"))throw new TypeError("Cannot specify an accessor and a value")}h.get&&b.call(a,g,h.get),h.set&&c.call(a,g,h.set);return a}),Object.getOwnPropertyDescriptor||(Object.getOwnPropertyDescriptor=function(a,b){if(arguments.length<2)throw new TypeError("Arguments not optional.");b+="";var c={configurable:!0,enumerable:!0,writable:!0},g=d.call(a,b),h=e.call(a,b);if(!f.call(a,b))return c;if(!g&&!h){c.value=a[b];return c}delete c.writable,c.get=c.set=undefined,g&&(c.get=g),h&&(c.set=h);return c}),Object.defineProperties||(Object.defineProperties=function(a,b){for(var c in b)f.call(b,c)&&Object.defineProperty(a,c,b[c])}))}()